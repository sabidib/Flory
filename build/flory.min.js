var Flory={VERSION:"0.01",timestep:.01,Entity:function(){this.id=Flory.Entity.entityIDCount++;this.name=""}};Flory.Entity.prototype={update:function(a){}};Flory.Entity.entityIDCount=0;Flory.Environment=function(){this.entities=[]};
Flory.Environment.prototype={constuctor:Flory.Environment,add:function(a){if(this.id==a.id)console.log("Flory: Can't add an entity to itself.");else{for(var b=0,c=this.entities.length;b<c;b++)if(this.entities[b].id===a.id){console.log("Flory : Can't add an entity twice to the same enviroment.");return}this.entities.push(a)}}};
Flory.Field=function(a){Flory.Entity.call(this);this.data=[];for(var b=0,c=a.length;b<c;b++)this.data[b]={},void 0==a[b].position?this.data[b].position=new Flory.Vector(a[b][0]):a[b].position instanceof Array?this.data[b].position=new Flory.Vector(a[b].position):void 0!=a[b].position.components&&(this.data[b].position=a[b].position.clone()),void 0==a[b].vector?this.data[b].vector=new Flory.Vector(a[b][1]):a[b].vector instanceof Array?this.data[b].vector=new Flory.Vector(a[b].vector):void 0!=a[b].vector.components&&
(this.data[b].vector=a[b].vector.clone())};Flory.Field.prototype=Object.create(Flory.Entity.prototype);Flory.Field.prototype.constructor=Flory.Field;Flory.Field.prototype.getForce=function(a,b){for(var c=Infinity,e=0,d=0,f=this.data.length;d<f;d++){var g=this.data[d].position.distanceToSq(a);g<=c&&(e=d,c=g)}return this.data[e].vector};Flory.Field.prototype.combine=function(a){};Flory.Field.prototype.scale=function(a){for(var b=0,c=this.data.length;b<c;b++)this.data[b].vector.scale(a)};
Flory.Field.prototype.clone=function(){return new Flory.Field(this.data)};
Flory.Field2D=function(a){Flory.Entity.call(this);this.data=[];for(var b=0,c=a.length;b<c;b++)this.data[b]={},void 0==a[b].position?this.data[b].position=new Flory.Vector2(a[b][0][0],a[b][0][1]):a[b].position instanceof Array?this.data[b].position=new Flory.Vector2(a[b].position[0],a[b].position[1]):void 0!=a[b].position.x&&void 0!=a[b].position.y&&(this.data[b].position=a[b].position.clone()),void 0==a[b].vector?this.data[b].vector=new Flory.Vector2(a[b][1][0],a[b][1][1]):a[b].vector instanceof Array?
this.data[b].vector=new Flory.Vector2(a[b].vector[0],a[b].vector[1]):void 0!=a[b].vector.x&&void 0!=a[b].vector.y&&(this.data[b].vector=a[b].vector.clone())};Flory.Field2D.prototype=Object.create(Flory.Entity.prototype);Flory.Field2D.prototype.constructor=Flory.Field2D;Flory.Field2D.prototype.getForce=function(a,b){for(var c=0,e=0,d=0,f=this.data.length;d<f;d++){var g=this.data[d].position.distanceToSq(a);g<=c&&(e=d,c=g)}return this.data[e].vector};Flory.Field2D.prototype.combine=function(a){};
Flory.Field2D.prototype.scale=function(a){for(var b=0,c=this.data.length;b<c;b++)this.data[b].vector.scale(a)};Flory.Field2D.prototype.clone=function(){return new Flory.Field2D(this.data)};
Flory.Field3D=function(a){Flory.Entity.call(this);this.data=[];for(var b=0,c=a.length;b<c;b++)this.data[b]={},void 0==a[b].position?this.data[b].position=new Flory.Vector3(a[b][0][0],a[b][0][1],a[b][0][2]):a[b].position instanceof Array?this.data[b].position=new Flory.Vector3(a[b].position[0],a[b].position[1],a[b].position[2]):void 0!=a[b].position.x&&void 0!=a[b].position.y&&void 0!=a[b].position.z&&(this.data[b].position=a[b].position.clone()),void 0==a[b].vector?this.data[b].vector=new Flory.Vector3(a[b][1][0],
a[b][1][1],a[b][1][2]):a[b].vector instanceof Array?this.data[b].vector=new Flory.Vector3(a[b].vector[0],a[b].vector[1],a[b].vector[2]):void 0!=a[b].vector.x&&void 0!=a[b].vector.y&&void 0!=a[b].postiion.z&&(this.data[b].vector=a[b].vector.clone())};Flory.Field3D.prototype=Object.create(Flory.Entity.prototype);Flory.Field3D.prototype.constructor=Flory.Field3D;
Flory.Field3D.prototype.getForce=function(a,b){for(var c=0,e=0,d=0,f=this.data.length;d<f;d++){var g=this.data[d].position.distanceToSq(a);g<=c&&(e=d,c=g)}return this.data[e].vector};Flory.Field3D.prototype.combine=function(a){};Flory.Field3D.prototype.scale=function(a){for(var b=0,c=this.data.length;b<c;b++)this.data[b].vector.scale(a)};Flory.Field3D.prototype.clone=function(){return new Flory.Field3D(this.data)};
Flory.Vector3=function(a,b,c){this.x=void 0===a?0:a;this.y=void 0===b?0:b;this.z=void 0===c?0:c};
Flory.Vector3.prototype={constructor:Flory.Vector3,dimension:function(){return 3},add:function(a){this.x+=a.x;this.y+=a.y;this.z+=a.z;return this},sub:function(a){this.x-=a.x;this.y-=a.y;this.z-=a.z;return this},scale:function(a){this.x*=a;this.y*=a;this.z*=a;return this},mult:function(a){return new Flory.Vector3(this.x*a,this.y*a,this.z*a)},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthSq:function(){return this.x*
this.x+this.y*this.y+this.z*this.z},distanceTo:function(a){return Math.sqrt((a.x-this.x)*(a.x-this.x)+(a.y-this.y)*(a.y-this.y)+(a.z-this.z)*(a.z-this.z))},distanceToSq:function(a){return(a.x-this.x)*(a.x-this.x)+(a.y-this.y)*(a.y-this.y)+(a.z-this.z)*(a.z-this.z)},clone:function(){return new Flory.Vector3(this.x,this.y,this.z)}};Flory.Vector2=function(a,b){this.x=void 0===a?0:a;this.y=void 0===b?0:b};
Flory.Vector2.prototype={constructor:Flory.Vector2,dimension:function(){return 2},add:function(a){this.x+=a.x;this.y+=a.y;return this},sub:function(a){this.x-=a.x;this.y-=a.y;return this},scale:function(a){this.x*=a;this.y*=a;return this},mult:function(a){return new Flory.Vector2(this.x*a,this.y*a)},dot:function(a){return this.x*a.x+this.y*a.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},lengthSq:function(){return this.x*this.x+this.y*this.y},distanceTo:function(a){return Math.sqrt((a.x-
this.x)*(a.x-this.x)+(a.y-this.y)*(a.y-this.y))},distanceToSq:function(a){return(a.x-this.x)*(a.x-this.x)+(a.y-this.y)*(a.y-this.y)},clone:function(){return new Flory.Vector2(this.x,this.y)}};Flory.Vector=function(a){this.components=void 0==a?[]:a};
Flory.Vector.prototype={constructor:Flory.Vector,dimension:function(){return this.components.length},add:function(a){if(a.components.length>this.components.length){for(var b=0,c=this.components.length;b<c;b++)this.components[b]+=a.components[b];for(c=a.components.length;b<c;b++)this.components[b]=0,this.components[b]+=a.components[b]}else for(var b=0,c=a.components.length;b<c;b++)this.components[b]+=a.components[b];return this},sub:function(a){if(a.components.length>this.components.length){for(var b=
0,c=this.components.length;b<c;b++)this.components[b]-=a.components[b];for(c=a.components.length;b<c;b++)this.components[b]=0,this.components[b]-=a.components[b]}else for(var b=0,c=a.components.length;b<c;b++)this.components[b]-=a.components[b];return this},scale:function(a){for(var b=0,c=this.components.length;b<c;b++)this.components[b]*=a;return this},mult:function(a){components=[];for(var b=0,c=this.components.length;b<c;b++)components[b]=a*this.components[b];return new Flory.Vector(components)},
dot:function(a){if(a.components.length!=this.components.length)console.log("Flory.vector.dot(a) can only accept a vector of the same dimension as the object.");else{for(var b=0,c=0,e=a.components.length;c<e;c++)b+=this.components[c]*a.components[c];return b}},length:function(){for(var a=0,b=0,c=this.components.length;b<c;b++)a+=this.components[b]*this.components[b];return Math.sqrt(a)},lengthSq:function(){for(var a=0,b=0,c=this.components.length;b<c;b++)a+=this.components[b]*this.components[b];return a},
distanceTo:function(a){var b=0,c=0;if(a.components.length>this.components.length){for(var e=this.components.length;c<e;c++)b+=(this.components[c]-a.components[c])*(this.components[c]-a.components[c]);for(;c<len2;c++)b+=(0-a.components[c])*(0-a.components[c])}else if(a.components.length<this.components.length){for(e=a.components.length;c<e;c++)b+=(this.components[c]-a.components[c])*(this.components[c]-a.components[c]);for(;c<len2;c++)b+=(this.components[c]-0)*(this.components[c]-0)}else for(e=a.components.length;c<
e;c++)b+=(this.components[c]-a.components[c])*(this.components[c]-a.components[c]);return Math.sqrt(b)},distanceToSq:function(a){var b=0,c=0;if(a.components.length>this.components.length){for(var e=this.components.length;c<e;c++)b+=(this.components[c]-a.components[c])*(this.components[c]-a.components[c]);for(;c<len2;c++)b+=(0-a.components[c])*(0-a.components[c])}else if(a.components.length<this.components.length){for(e=a.components.length;c<e;c++)b+=(this.components[c]-a.components[c])*(this.components[c]-
a.components[c]);for(;c<len2;c++)b+=(this.components[c]-0)*(this.components[c]-0)}else for(e=a.components.length;c<e;c++)b+=(this.components[c]-a.components[c])*(this.components[c]-a.components[c]);return b},clone:function(){return new Flory.Vector(this.components)}};Flory.RandomGen=function(a){void 0==a&&(a=(new Date).getTime());this.N=624;this.M=397;this.MATRIX_A=2567483615;this.UPPER_MASK=2147483648;this.LOWER_MASK=2147483647;this.mt=Array(this.N);this.mti=this.N+1;this.init_genrand(a)};
Flory.RandomGen.prototype.init_genrand=function(a){this.mt[0]=a>>>0;for(this.mti=1;this.mti<this.N;this.mti++)a=this.mt[this.mti-1]^this.mt[this.mti-1]>>>30,this.mt[this.mti]=(1812433253*((a&4294901760)>>>16)<<16)+1812433253*(a&65535)+this.mti,this.mt[this.mti]>>>=0};
Flory.RandomGen.prototype.init_by_array=function(a,b){var c,e,d;this.init_genrand(19650218);c=1;e=0;for(d=this.N>b?this.N:b;d;d--){var f=this.mt[c-1]^this.mt[c-1]>>>30;this.mt[c]=(this.mt[c]^(1664525*((f&4294901760)>>>16)<<16)+1664525*(f&65535))+a[e]+e;this.mt[c]>>>=0;c++;e++;c>=this.N&&(this.mt[0]=this.mt[this.N-1],c=1);e>=b&&(e=0)}for(d=this.N-1;d;d--)f=this.mt[c-1]^this.mt[c-1]>>>30,this.mt[c]=(this.mt[c]^(1566083941*((f&4294901760)>>>16)<<16)+1566083941*(f&65535))-c,this.mt[c]>>>=0,c++,c>=this.N&&
(this.mt[0]=this.mt[this.N-1],c=1);this.mt[0]=2147483648};
Flory.RandomGen.prototype.genrand_int32=function(){var a,b=[0,this.MATRIX_A];if(this.mti>=this.N){var c;this.mti==this.N+1&&this.init_genrand(5489);for(c=0;c<this.N-this.M;c++)a=this.mt[c]&this.UPPER_MASK|this.mt[c+1]&this.LOWER_MASK,this.mt[c]=this.mt[c+this.M]^a>>>1^b[a&1];for(;c<this.N-1;c++)a=this.mt[c]&this.UPPER_MASK|this.mt[c+1]&this.LOWER_MASK,this.mt[c]=this.mt[c+(this.M-this.N)]^a>>>1^b[a&1];a=this.mt[this.N-1]&this.UPPER_MASK|this.mt[0]&this.LOWER_MASK;this.mt[this.N-1]=this.mt[this.M-
1]^a>>>1^b[a&1];this.mti=0}a=this.mt[this.mti++];a^=a>>>11;a^=a<<7&2636928640;a^=a<<15&4022730752;return(a^a>>>18)>>>0};Flory.RandomGen.prototype.genrand_int31=function(){return this.genrand_int32()>>>1};Flory.RandomGen.prototype.genrand_real1=function(){return this.genrand_int32()*(1/4294967295)};Flory.RandomGen.prototype.random=function(){return this.genrand_int32()*(1/4294967296)};Flory.RandomGen.prototype.genrand_real3=function(){return(this.genrand_int32()+.5)*(1/4294967296)};
Flory.RandomGen.prototype.genrand_res53=function(){var a=this.genrand_int32()>>>5,b=this.genrand_int32()>>>6;return 1.1102230246251565E-16*(67108864*a+b)};
Flory.Monomer2D=function(a,b,c,e){Flory.Entity.call(this);var d=void 0,f=void 0,g=void 0,h=void 0;void 0!=e&&(d=e.position,f=e.velocity,g=e.acceleration,h=e.force);this.radius=void 0!=a?a:Flory.Monomer2D.defaultRadius;this.charge=void 0!=b?b:0;this.mass=void 0!=c?c:0;void 0==d?this.position=new Flory.Vector2(0,0):d instanceof Array?this.position=new Flory.Vector2(d[0],d[1]):void 0!=d.x&&void 0!=d.y&&(this.position=new Flory.Vector2(d.x,d.y));void 0==f?this.velocity=new Flory.Vector2(0,0):f instanceof
Array?this.velocity=new Flory.Vector2(f[0],f[1]):void 0!=f.x&&void 0!=f.y&&(this.velocity=new Flory.Vector2(f.x,f.y));void 0==g?this.acceleration=new Flory.Vector2(0,0):g instanceof Array?this.acceleration=new Flory.Vector2(g[0],g[1]):void 0!=g.x&&void 0!=g.y&&(this.acceleration=new Flory.Vector2(g.x,g.y));void 0==h?this.force=new Flory.Vector2(0,0):h instanceof Array?this.force=new Flory.Vector2(h[0],h[1]):void 0!=h.x&&void 0!=h.y&&(this.force=new Flory.Vector2(h.x,h.y))};
Flory.Monomer2D.prototype=Object.create(Flory.Entity.prototype);Flory.Monomer2D.prototype.incrementX=function(a){this.position.x+=a;return this};Flory.Monomer2D.prototype.incrementY=function(a){this.position.y+=a;return this};Flory.Monomer2D.prototype.distanceTo=function(a){return this.position.distanceTo(a.position)};Flory.Monomer2D.prototype.distanceToSq=function(a){return this.position.distanceToSq(a.position)};Flory.Monomer2D.prototype.clone=function(){return new Flory.Monomer2D(this.radius,this.position)};
Flory.Monomer2D.defaultRadius=1;
Flory.Monomer3D=function(a,b,c,e){Flory.Entity.call(this);var d=void 0,f=void 0,g=void 0,h=void 0;void 0!=e&&(d=e.position,f=e.velocity,g=e.acceleration,h=e.force);this.radius=void 0!==a?a:Flory.Monomer3D.defaultRadius;this.charge=void 0!==b?b:0;this.mass=void 0!=c?c:0;void 0==d?this.position=new Flory.Vector3(0,0):d instanceof Array?this.position=new Flory.Vector3(d[0],d[1]):void 0!=d.x&&void 0!=d.y&&void 0!=d.z&&(this.position=new Flory.Vector3(d.x,d.y));void 0==f?this.velocity=new Flory.Vector3(0,
0):f instanceof Array?this.velocity=new Flory.Vector3(f[0],f[1]):void 0!=f.x&&void 0!=f.y&&void 0!=f.z&&(this.velocity=new Flory.Vector3(f.x,f.y));void 0==g?this.acceleration=new Flory.Vector3(0,0):g instanceof Array?this.acceleration=new Flory.Vector3(g[0],g[1]):void 0!=g.x&&void 0!=g.y&&void 0!=g.z&&(this.acceleration=new Flory.Vector3(g.x,g.y));void 0==h?this.force=new Flory.Vector3(0,0):h instanceof Array?this.force=new Flory.Vector3(h[0],h[1]):void 0!=h.x&&void 0!=h.y&&void 0!=h.z&&(this.force=
new Flory.Vector3(h.x,h.y))};Flory.Monomer3D.prototype=Object.create(Flory.Entity.prototype);Flory.Monomer3D.prototype.incrementX=function(a){this.position.x+=a;return this};Flory.Monomer3D.prototype.incrementY=function(a){this.position.y+=a;return this};Flory.Monomer3D.prototype.incrementZ=function(a){this.position.z+=a;return this};Flory.Monomer3D.prototype.distanceTo=function(a){return this.position.distanceTo(a.position)};Flory.Monomer3D.prototype.distanceToSq=function(a){return this.position.distanceToSq(a.position)};
Flory.Monomer3D.prototype.clone=function(){return new Flory.Monomer3D(this.radius,this.position)};Flory.Monomer3D.defaultRadius=1;
Flory.Monomer=function(a,b,c,e){if(void 0==e)console.log("Flory: Flory.Monomer needs at least the kinematics.position to know what the dimension of the monomer is.");else if(void 0==e.position)console.log("Flory: Flory.Monomer needs at least the kinematics.position to know what the dimension of the monomer is.");else{Flory.Entity.call(this);var d=void 0,f=void 0,g=void 0,h=void 0;void 0!=e&&(d=e.position,f=e.velocity,g=e.acceleration,h=e.force);this.radius=void 0!=a?a:Flory.Monomer.defaultRadius;
this.charge=void 0!=b?b:0;this.mass=void 0!=c?c:0;this.position=void 0==d.components&&d instanceof Array?new Flory.Vector(d):d.clone();this.velocity=void 0==f?new Flory.Vector([].slice.apply(new Uint8Array(this.position.dimension()))):void 0==f.components&&f instanceof Array?new Flory.Vector(f):f.clone();this.acceleration=void 0==g?new Flory.Vector([].slice.apply(new Uint8Array(this.position.dimension()))):void 0==g.components&&g instanceof Array?new Flory.Vector(g):g.clone();this.force=void 0==h?
new Flory.Vector([].slice.apply(new Uint8Array(this.position.dimension()))):void 0==h.components&&h instanceof Array?new Flory.Vector(h):h.clone()}};Flory.Monomer.prototype=Object.create(Flory.Entity.prototype);Flory.Monomer.prototype.incrementDimension=function(a,b){this.position.components[a]+=b;return this};Flory.Monomer.prototype.distanceTo=function(a){return this.position.distanceTo(a.position)};Flory.Monomer.prototype.distanceToSq=function(a){return this.position.distanceToSq(a.position)};
Flory.Monomer.prototype.clone=function(){return new Flory.Monomer3D(this.radius,this.position)};Flory.Monomer.defaultRadius=1;Flory.Newtonian=function(){Flory.Environment.call(this)};Flory.Newtonian.prototype=Object.create(Flory.Environment.prototype);
Flory.Newtonian.prototype.update=function(a){a=0;for(var b=this.entities.length;a<b;a++){var c=this.entities[a],e=new Flory.Vector;if(c instanceof Flory.Monomer){for(var d=0,b=this.entities.length;d<b;d++){var f=this.entities[d];f instanceof Flory.Field&&e.add(f.getForce(c.position))}c.force=e.clone()}}a=0;for(b=this.entities.length;a<b;a++)c=this.entities[a],c instanceof Flory.Monomer&&(c.acceleration=c.force.mult(1/c.mass),c.velocity.add(c.acceleration.mult(Flory.timestep)),c.position.add(c.velocity.mult(.5*
Flory.timestep)));return this};Flory.RandomWalk=function(a,b){Flory.Environment.call(this);this.randomGen=new Flory.RandomGen(a);this.step_size=void 0!=b?b:1};Flory.RandomWalk.prototype=Object.create(Flory.Environment.prototype);Flory.RandomWalk.prototype.constructor=Flory.RandomWalk;
Flory.RandomWalk.prototype.update=function(a){a=0;for(var b=this.entities.length;a<b;a++){var c=this.entities[a];if(c instanceof Flory.Monomer){for(var e=1/c.position.dimension(),d=0,f=this.randomGen.random(),f=f-e;0<f;)f-=e,d++;f=this.randomGen.random();.5>f?c.position.components[d]++:c.position.components[d]--}}return this};
