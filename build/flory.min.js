var Flory={VERSION:"0.01",timestep:.01,Entity:function(){this.id=Flory.Entity.entityIDCount++;this.name="";this.position={};this.velocity={};this.acceleration={};this.charge=0}};Flory.Entity.prototype={update:function(){}};Flory.Entity.entityIDCount=0;
Flory.Field=function(a){this.data=[];for(var c=0,d=a.length;c<d;c++)this.data[c]={},void 0==a[c].position?this.data[c].position=new Flory.Vector(a[c][0]):a[c].position instanceof Array?this.data[c].position=new Flory.Vector(a[c].position):void 0!=a[c].position.components&&(this.data[c].position=a[c].position.clone()),void 0==a[c].vector?this.data[c].vector=new Flory.Vector(a[c][1]):a[c].vector instanceof Array?this.data[c].vector=new Flory.Vector(a[c].vector):void 0!=a[c].vector.components&&(this.data[c].vector=
a[c].vector.clone())};Flory.Field.prototype={constructor:Flory.Field,getForce:function(a){for(var c=0,d=0,e=0,f=this.data.length;e<f;e++){var g=this.data[e].position.distanceToSq(a);g<c&&(d=e,c=g)}return this.data[d].vector},scale:function(a){for(var c=0,d=this.data.length;c<d;c++)this.data[c].vector.scale(a)},clone:function(){return new Flory.Field(this.data)}};
Flory.Field2D=function(a){this.data=[];for(var c=0,d=a.length;c<d;c++)this.data[c]={},void 0==a[c].position?this.data[c].position=new Flory.Vector2(a[c][0][0],a[c][0][1]):a[c].position instanceof Array?this.data[c].position=new Flory.Vector2(a[c].position[0],a[c].position[1]):void 0!=a[c].position.x&&void 0!=a[c].position.y&&(this.data[c].position=a[c].position.clone()),void 0==a[c].vector?this.data[c].vector=new Flory.Vector2(a[c][1][0],a[c][1][1]):a[c].vector instanceof Array?this.data[c].vector=
new Flory.Vector2(a[c].vector[0],a[c].vector[1]):void 0!=a[c].vector.x&&void 0!=a[c].vector.y&&(this.data[c].vector=a[c].vector.clone())};Flory.Field2D.prototype={constructor:Flory.Field2D,getForce:function(a){for(var c=0,d=0,e=0,f=this.data.length;e<f;e++){var g=this.data[e].position.distanceToSq(a);g<c&&(d=e,c=g)}return this.data[d].vector},scale:function(a){for(var c=0,d=this.data.length;c<d;c++)this.data[c].vector.scale(a)},clone:function(){return new Flory.Field2D(this.data)}};
Flory.Field3D=function(a){this.data=[];for(var c=0,d=a.length;c<d;c++)this.data[c]={},void 0==a[c].position?this.data[c].position=new Flory.Vector3(a[c][0][0],a[c][0][1],a[c][0][2]):a[c].position instanceof Array?this.data[c].position=new Flory.Vector3(a[c].position[0],a[c].position[1],a[c].position[2]):void 0!=a[c].position.x&&void 0!=a[c].position.y&&void 0!=a[c].position.z&&(this.data[c].position=a[c].position.clone()),void 0==a[c].vector?this.data[c].vector=new Flory.Vector3(a[c][1][0],a[c][1][1],
a[c][1][2]):a[c].vector instanceof Array?this.data[c].vector=new Flory.Vector3(a[c].vector[0],a[c].vector[1],a[c].vector[2]):void 0!=a[c].vector.x&&void 0!=a[c].vector.y&&void 0!=a[c].postiion.z&&(this.data[c].vector=a[c].vector.clone())};
Flory.Field3D.prototype={constructor:Flory.Field3D,getForce:function(a){for(var c=0,d=0,e=0,f=this.data.length;e<f;e++){var g=this.data[e].position.distanceToSq(a);g<c&&(d=e,c=g)}return this.data[d].vector},scale:function(a){for(var c=0,d=this.data.length;c<d;c++)this.data[c].vector.scale(a)},clone:function(){return new Flory.Field3D(this.data)}};Flory.Vector3=function(a,c,d){this.x=void 0===a?0:a;this.y=void 0===c?0:c;this.z=void 0===d?0:d};
Flory.Vector3.prototype={constructor:Flory.Vector3,dimension:function(){return 3},add:function(a){this.x+=a.x;this.y+=a.y;this.z+=a.z;return this},sub:function(a){this.x-=a.x;this.y-=a.y;this.z-=a.z;return this},scale:function(a){this.x*=a;this.y*=a;this.z*=a;return this},mult:function(a){return new Flory.Vector3(this.x*a,this.y*a,this.z*a)},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthSq:function(){return this.x*
this.x+this.y*this.y+this.z*this.z},distanceTo:function(a){return Math.sqrt((a.x-this.x)*(a.x-this.x)+(a.y-this.y)*(a.y-this.y)+(a.z-this.z)*(a.z-this.z))},distanceToSq:function(a){return(a.x-this.x)*(a.x-this.x)+(a.y-this.y)*(a.y-this.y)+(a.z-this.z)*(a.z-this.z)},clone:function(){return new Flory.Vector3(this.x,this.y,this.z)}};Flory.Vector2=function(a,c){this.x=void 0===a?0:a;this.y=void 0===c?0:c};
Flory.Vector2.prototype={constructor:Flory.Vector2,dimension:function(){return 2},add:function(a){this.x+=a.x;this.y+=a.y;return this},sub:function(a){this.x-=a.x;this.y-=a.y;return this},scale:function(a){this.x*=a;this.y*=a;return this},mult:function(a){return new Flory.Vector2(this.x*a,this.y*a)},dot:function(a){return this.x*a.x+this.y*a.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},lengthSq:function(){return this.x*this.x+this.y*this.y},distanceTo:function(a){return Math.sqrt((a.x-
this.x)*(a.x-this.x)+(a.y-this.y)*(a.y-this.y))},distanceToSq:function(a){return(a.x-this.x)*(a.x-this.x)+(a.y-this.y)*(a.y-this.y)},clone:function(){return new Flory.Vector2(this.x,this.y)}};Flory.Vector=function(a){this.components=a};
Flory.Vector.prototype={constructor:Flory.Vector,dimension:function(){return this.components.length},add:function(a){for(var c=0,d=this.a.length;c<d;c++)this.components[c]+=a[c];return this},sub:function(a){for(var c=0,d=this.a.length;c<d;c++)this.components[c]-=a[c];return this},scale:function(a){for(var c=0,d=this.components.length;c<d;c++)this.components[c]*=a;return this},mult:function(a){components=[];for(var c=0,d=this.components.length;c<d;c++)components[c]=a*this.components[c];return new Flory.Vector(components)},
dot:function(a){if(a.length!=b.length)console.log("Flory.vector.dot(a) can only accept a vector of the same dimension as the object.");else{for(var c=0,d=0,e=this.a.length;d<e;d++)c+=this.components[d]*a[d];return c}},length:function(){for(var a=0,c=0,d=this.components.length;c<d;c++)a+=this.components[c]*this.components[c];return Math.sqrt(a)},lengthSq:function(){for(var a=0,c=0,d=this.components.length;c<d;c++)a+=this.components[c]*this.components[c];return a},distanceTo:function(a){for(var c=0,
d=0,e=this.a.length;d<e;d++)c+=(this.components[d]-a.components[d])*(this.components[d]-a.components[d]);d=0;e=this.components.length;for(a=this.components.length-this.a.length;a<e;d++)c+=this.components[d+e]*this.components[d+e];return Math.sqrt(c)},distanceToSq:function(a){for(var c=0,d=0,e=this.a.length;d<e;d++)c+=(this.components[d]-a.components[d])*(this.components[d]-a.components[d]);d=0;e=this.components.length;for(a=this.components.length-this.a.length;a<e;d++)c+=this.components[d+e]*this.components[d+
e];return c},clone:function(){return new Flory.Vector(this.x,this.y,this.z)}};Flory.RandomGen=function(a){void 0==a&&(a=(new Date).getTime());this.N=624;this.M=397;this.MATRIX_A=2567483615;this.UPPER_MASK=2147483648;this.LOWER_MASK=2147483647;this.mt=Array(this.N);this.mti=this.N+1;this.init_genrand(a)};
Flory.RandomGen.prototype.init_genrand=function(a){this.mt[0]=a>>>0;for(this.mti=1;this.mti<this.N;this.mti++)a=this.mt[this.mti-1]^this.mt[this.mti-1]>>>30,this.mt[this.mti]=(1812433253*((a&4294901760)>>>16)<<16)+1812433253*(a&65535)+this.mti,this.mt[this.mti]>>>=0};
Flory.RandomGen.prototype.init_by_array=function(a,c){var d,e,f;this.init_genrand(19650218);d=1;e=0;for(f=this.N>c?this.N:c;f;f--){var g=this.mt[d-1]^this.mt[d-1]>>>30;this.mt[d]=(this.mt[d]^(1664525*((g&4294901760)>>>16)<<16)+1664525*(g&65535))+a[e]+e;this.mt[d]>>>=0;d++;e++;d>=this.N&&(this.mt[0]=this.mt[this.N-1],d=1);e>=c&&(e=0)}for(f=this.N-1;f;f--)g=this.mt[d-1]^this.mt[d-1]>>>30,this.mt[d]=(this.mt[d]^(1566083941*((g&4294901760)>>>16)<<16)+1566083941*(g&65535))-d,this.mt[d]>>>=0,d++,d>=this.N&&
(this.mt[0]=this.mt[this.N-1],d=1);this.mt[0]=2147483648};
Flory.RandomGen.prototype.genrand_int32=function(){var a,c=[0,this.MATRIX_A];if(this.mti>=this.N){var d;this.mti==this.N+1&&this.init_genrand(5489);for(d=0;d<this.N-this.M;d++)a=this.mt[d]&this.UPPER_MASK|this.mt[d+1]&this.LOWER_MASK,this.mt[d]=this.mt[d+this.M]^a>>>1^c[a&1];for(;d<this.N-1;d++)a=this.mt[d]&this.UPPER_MASK|this.mt[d+1]&this.LOWER_MASK,this.mt[d]=this.mt[d+(this.M-this.N)]^a>>>1^c[a&1];a=this.mt[this.N-1]&this.UPPER_MASK|this.mt[0]&this.LOWER_MASK;this.mt[this.N-1]=this.mt[this.M-
1]^a>>>1^c[a&1];this.mti=0}a=this.mt[this.mti++];a^=a>>>11;a^=a<<7&2636928640;a^=a<<15&4022730752;return(a^a>>>18)>>>0};Flory.RandomGen.prototype.genrand_int31=function(){return this.genrand_int32()>>>1};Flory.RandomGen.prototype.genrand_real1=function(){return this.genrand_int32()*(1/4294967295)};Flory.RandomGen.prototype.random=function(){return this.genrand_int32()*(1/4294967296)};Flory.RandomGen.prototype.genrand_real3=function(){return(this.genrand_int32()+.5)*(1/4294967296)};
Flory.RandomGen.prototype.genrand_res53=function(){var a=this.genrand_int32()>>>5,c=this.genrand_int32()>>>6;return 1.1102230246251565E-16*(67108864*a+c)};
Flory.Monomer2D=function(a,c,d,e,f){Flory.Entity.call(this);this.radius=void 0!=a?a:Flory.Monomer2D.defaultRadius;this.charge=void 0!=c?c:0;void 0==d?this.position=new Flory.Vector2(0,0):d instanceof Array?this.position=new Flory.Vector2(d[0],d[1]):void 0!=d.x&&void 0!=d.y&&(this.position=new Flory.Vector2(d.x,d.y));void 0==e?this.velocity=new Flory.Vector2(0,0):e instanceof Array?this.velocity=new Flory.Vector2(e[0],e[1]):void 0!=e.x&&void 0!=e.y&&(this.velocity=new Flory.Vector2(e.x,e.y));void 0==
f?this.acceleration=new Flory.Vector2(0,0):f instanceof Array?this.acceleration=new Flory.Vector2(f[0],f[1]):void 0!=f.x&&void 0!=f.y&&(this.acceleration=new Flory.Vector2(f.x,f.y))};Flory.Monomer2D.prototype=Object.create(Flory.Entity.prototype);Flory.Monomer2D.prototype.update=function(){this.velocity.add(this.acceleration.mult(Flory.timestep));this.position.add(this.velocity.mult(.5*Flory.timestep));return this};Flory.Monomer2D.prototype.incrementX=function(a){this.position.x+=a;return this};
Flory.Monomer2D.prototype.incrementY=function(a){this.position.y+=a;return this};Flory.Monomer2D.prototype.distanceTo=function(a){return this.position.distanceTo(a.position)};Flory.Monomer2D.prototype.distanceToSq=function(a){return this.position.distanceToSq(a.position)};Flory.Monomer2D.prototype.clone=function(){return new Flory.Monomer2D(this.radius,this.position)};Flory.Monomer2D.defaultRadius=1;
Flory.Monomer3D=function(a,c,d,e,f){Flory.Entity.call(this);this.radius=void 0!==a?a:Flory.Monomer3D.defaultRadius;this.charge=void 0!==c?c:0;void 0==d?this.position=new Flory.Vector3(0,0):d instanceof Array?this.position=new Flory.Vector3(d[0],d[1]):void 0!=d.x&&void 0!=d.y&&void 0!=d.z&&(this.position=new Flory.Vector3(d.x,d.y));void 0==e?this.velocity=new Flory.Vector3(0,0):e instanceof Array?this.velocity=new Flory.Vector3(e[0],e[1]):void 0!=e.x&&void 0!=e.y&&void 0!=e.z&&(this.velocity=new Flory.Vector3(e.x,
e.y));void 0==f?this.acceleration=new Flory.Vector3(0,0):f instanceof Array?this.acceleration=new Flory.Vector3(f[0],f[1]):void 0!=f.x&&void 0!=f.y&&void 0!=f.z&&(this.acceleration=new Flory.Vector3(f.x,f.y))};Flory.Monomer3D.prototype=Object.create(Flory.Entity.prototype);Flory.Monomer3D.prototype.update=function(){this.velocity.add(this.acceleration.scale(Flory.timestep));this.position.add(this.velocity.scale(Flory.timestep).scale(.5));return this};
Flory.Monomer3D.prototype.incrementX=function(a){this.position.x+=a;return this};Flory.Monomer3D.prototype.incrementY=function(a){this.position.y+=a;return this};Flory.Monomer3D.prototype.incrementZ=function(a){this.position.z+=a;return this};Flory.Monomer3D.prototype.distanceTo=function(a){return this.position.distanceTo(a.position)};Flory.Monomer3D.prototype.distanceToSq=function(a){return this.position.distanceToSq(a.position)};
Flory.Monomer3D.prototype.clone=function(){return new Flory.Monomer3D(this.radius,this.position)};Flory.Monomer3D.defaultRadius=1;
Flory.Monomer=function(a,c,d,e,f){Flory.Entity.call(this);this.radius=void 0!=a?a:Flory.Monomer.defaultRadius;this.charge=void 0!=c?c:0;this.position=void 0==d.components&&d instanceof Array?new Flory.Vector(d):d.clone();this.velocity=void 0==e.components&&e instanceof Array?new Flory.Vector(e):e.clone();this.acceleration=void 0==f.components&&f instanceof Array?new Flory.Vector(f):f.clone()};Flory.Nonomer.prototype=Object.create(Flory.Entity.prototype);
Flory.Monomer.prototype.update=function(){this.velocity.add(this.acceleration.scale(Flory.timestep));this.position.add(this.velocity.scale(Flory.timestep).scale(.5));return this};Flory.Monomer.prototype.incrementDimension=function(a,c){this.position.components[a]+=c;return this};Flory.Monomer.prototype.distanceTo=function(a){return this.position.distanceTo(a.position)};Flory.Monomer.prototype.distanceToSq=function(a){return this.position.distanceToSq(a.position)};
Flory.Monomer.prototype.clone=function(){return new Flory.Monomer3D(this.radius,this.position)};Flory.Monomer.defaultRadius=1;
